#include "poseSLAM.h"
#include <stdio.h>

int main(int argc, char *argv[])
{
  // odometry values (MATLAB sensors simulation)
	uint nSteps=499;
	MatrixXd odometry(498,3);

	odometry << 	0.321956658257, -0.00116613800813, -0.0102577881984,
	0.327212103702, -0.00267064274499, -0.0152121947325,
	0.307443359248, -0.00264960182819, -0.00302717897798,
	0.352955538603, -0.00434812663122, -0.0121857784214,
	0.324433446157, -0.00307306756005, -0.0222564840645,
	0.310538312231, -0.00313011052466, -0.0168118714868,
	0.330533250788, -0.00160579133694, -0.00963222557972,
	0.29429377684, -0.00231897178915, -0.0183754184766,
	0.315910351963, -0.00201781555708, -0.00768787062249,
	0.30119523507, -0.00277407238537, -0.0138108039929,
	0.316656863727, -0.00423740376769, -0.030572434302,
	0.291203562897, -0.00605311597525, -0.0146337863271,
	0.304055786151, -0.00388516467191, -0.0203580329392,
	0.273852141368, -0.00326199787089, -0.0240877004376,
	0.303184542895, -0.0028527481073, -0.0166647399105,
	0.292873539324, -0.00338317645383, -0.0239565193193,
	0.304158176086, -0.00213150700876, -0.0221580400948,
	0.287703718907, -0.00449301506787, -0.0333510995512,
	0.283229835618, -0.00177505332905, -0.0232272096486,
	0.285310870477, -0.00357409621773, -0.0161081830084,
	0.259877926716, -0.0033599987551, -0.0257368435952,
	0.286276382153, -0.00189836982377, -0.0272723893101,
	0.249445911572, -0.00422500790938, -0.0279057463303,
	0.297309113945, -0.00415606631423, -0.0235019395669,
	0.25818906625, -0.00268579615228, -0.0181108320203,
	0.238099062994, -0.00504960211258, -0.020026546831,
	0.250148239728, -0.00388481546126, -0.0224950233713,
	0.254560627803, -0.003545129707, -0.019956424498,
	0.235532694091, -0.00311126606606, -0.0256292853358,
	0.236488036624, -0.00365864532206, -0.0279059129704,
	0.221511034343, -0.00382614724583, -0.0202631322484,
	0.269100526035, -0.00467037019313, -0.0372320606372,
	0.229488527485, -0.00600037403414, -0.0439829811612,
	0.199961126533, -0.00329690948241, -0.0414872497965,
	0.223469968317, -0.00475130873725, -0.0446864045602,
	0.211144873738, -0.00379711937169, -0.0357916417713,
	0.239777153501, -0.00454546985865, -0.0485486691097,
	0.200640135507, -0.00306619731927, -0.0458368788223,
	0.222483440731, -0.00436798174275, -0.0324639029004,
	0.179580917501, -0.00475151284146, -0.0487130033051,
	0.242054460578, -0.00379354375294, -0.049536277236,
	0.18710368427, -0.00514991910245, -0.0461715298072,
	0.212707265107, -0.00503156132643, -0.0541045128026,
	0.167647805658, -0.00513877497889, -0.0469593398442,
	0.172339291483, -0.00434041904218, -0.0483500764681,
	0.193756604536, -0.00622296832085, -0.0338513738465,
	0.194806703099, -0.00522435646674, -0.0512066241806,
	0.184697631759, -0.00669846398072, -0.052602546203,
	0.178183462579, -0.00594585973087, -0.0492204101916,
	0.182757255994, -0.00698655645194, -0.049568881603,
	0.197015300331, -0.00501014392578, -0.0599171179231,
	0.178404334177, -0.00395817751048, -0.0402936967187,
	0.181496002869, -0.00361279656799, -0.0570981750413,
	0.185021358498, -0.00521834117908, -0.0531335952684,
	0.177103026846, -0.00238778164253, -0.0380229415589,
	0.199329638149, -0.00611895632647, -0.0591002962094,
	0.194549811005, -0.00403394573834, -0.0444905392033,
	0.166181347267, -0.00622004091158, -0.0489118108584,
	0.207905033635, -0.00426010528528, -0.0539383298008,
	0.206193449861, -0.00513438341356, -0.0386977237862,
	0.188652469438, -0.00414181286431, -0.0602338370484,
	0.205675530727, -0.00396536908739, -0.0378499115726,
	0.196691311254, -0.00319979984894, -0.0329843333079,
	0.216068160325, -0.0045796199312, -0.0316028271722,
	0.215781536335, -0.00428793817999, -0.0356413097356,
	0.236712288549, -0.00271812089242, -0.0333425411054,
	0.228020665288, -0.00355273171906, -0.0325597742382,
	0.21765313625, -0.00315568035309, -0.0397663060913,
	0.238438282627, -0.00350553807972, -0.0385032036513,
	0.227519758722, -0.00413058828599, -0.0194750030182,
	0.237185591387, -0.00221894694893, -0.0304328312903,
	0.241309570935, -0.00454357696139, -0.0360874022717,
	0.248247920255, -0.00404886794948, -0.013494104558,
	0.251333012522, -0.00478256924065, -0.0162119177908,
	0.275107066132, -0.00388710974481, -0.0279659903608,
	0.257731907123, -0.00376622303479, -0.0262417013544,
	0.263937374671, -0.00310657909298, -0.0203938873258,
	0.253488027111, -0.00444516889787, -0.0286212227252,
	0.266946707119, -0.00378119466128, -0.0189722243147,
	0.236467537406, -0.00386653166747, -0.019564043677,
	0.269280793202, -0.00244655086979, -0.0254815188525,
	0.28445538459, -0.0031493832428, -0.0185547507184,
	0.287119515283, -0.0016916604041, -0.0219310067867,
	0.292381714383, -0.00399763853191, -0.0192466110507,
	0.295649309437, -0.00280140438928, -0.0297315600517,
	0.292735075324, -0.00117194260481, -0.0371963270206,
	0.329143410414, -0.0028388520656, -0.0331622229396,
	0.278350552321, -0.00372705485198, -0.023004316872,
	0.30941327839, -0.00479441321323, -0.00776267207117,
	0.288756394286, -0.00302465168844, -0.015387155361,
	0.311946350857, -0.00198966672353, -0.00957831899348,
	0.300203325288, -0.00279658206475, -0.010594892016,
	0.292427723408, -0.0021210404024, -0.0167214574682,
	0.311685138605, -0.00211587676932, -0.0190941500705,
	0.318749067141, -0.00176398762082, -0.0147647154805,
	0.317575539585, -0.00370645582423, -0.0296016962969,
	0.329921605074, -0.00462018385535, -0.0202225682349,
	0.28672924607, -0.00196473055629, -0.0108245850764,
	0.313629252542, -0.00306922046984, -0.0283844855321,
	0.322113956221, -0.00518538327404, -0.0194244825364,
	0.31655991848, -0.00393949721444, -0.0245134381501,
	0.324157158636, -0.00214165892931, -0.0188636241348,
	0.320599055026, -0.00289188553745, -0.00753331254305,
	0.322577119053, -0.00210448069895, -0.0231186958445,
	0.309980380267, -0.00200149977191, -0.0199643830378,
	0.304782022901, -0.00429087970485, -0.016418164138,
	0.320644467125, -0.00221239659887, -0.0216934323701,
	0.302993526827, -0.00290829903799, -0.0145201629377,
	0.311498901842, -0.00266432128312, -0.0212681301735,
	0.303805032557, -0.00521081255389, -0.0106353516768,
	0.293590987507, -0.00430650434476, -0.0427968345126,
	0.2822659334, -0.00314483282038, -0.0244877759996,
	0.330357145588, -0.00200415663446, -0.03288573469,
	0.301943356654, -0.00456813297039, -0.0181397200757,
	0.294754768502, -0.00244962190933, -0.0173462447946,
	0.311564775265, -0.00370496570416, -0.0163731988579,
	0.296444127566, -0.00318237661653, -0.0166542520857,
	0.29020094952, -0.00407622424808, -0.0242337501156,
	0.30629482223, -0.00393387290813, -0.0274890829628,
	0.285542298568, -0.0032661128135, -0.0198614524893,
	0.26845717368, -0.00353384154529, -0.00929861193702,
	0.258133719296, -0.00267057126134, -0.0246911763996,
	0.26510951183, -0.00455673884656, -0.0216579528045,
	0.261699349781, -0.00502465681057, -0.0246406441335,
	0.251494249227, -0.00369454012259, -0.0105904597567,
	0.243799988092, -0.0039478062087, -0.0233214016005,
	0.226034658609, -0.00267501287578, -0.0223706648111,
	0.259998358494, -0.00408744680689, -0.0401472174482,
	0.227892343544, -0.00195786554183, -0.0350584417219,
	0.250087701644, -0.00477698107276, -0.0350605554527,
	0.22812904114, -0.00427552076915, -0.0440213295534,
	0.216749864387, -0.00495156937535, -0.0384869074319,
	0.205363288191, -0.00349666897182, -0.033140370403,
	0.234684221553, -0.00389574621917, -0.0288343847012,
	0.199526925735, -0.00526531070623, -0.0399596668719,
	0.218029121318, -0.00317568865568, -0.0314110972075,
	0.231261059432, -0.00390919510922, -0.0336774607208,
	0.211485176366, -0.00511009280159, -0.0515299009539,
	0.209469837067, -0.00369745197735, -0.0397968771478,
	0.197866082988, -0.00490186174342, -0.0478098280645,
	0.193735905057, -0.00483182462452, -0.0440392007279,
	0.199384303155, -0.00409709961873, -0.0427057914628,
	0.221428303484, -0.00446090669346, -0.0567655575628,
	0.184328823234, -0.00430329377952, -0.0441523192561,
	0.202287658801, -0.00427308892217, -0.0608808584541,
	0.173447121979, -0.00633960767389, -0.0405214108283,
	0.210583101459, -0.00526422630831, -0.0569086921364,
	0.197833423079, -0.00600984690275, -0.0446608129146,
	0.177560757724, -0.00345847362802, -0.0587099150064,
	0.211697968789, -0.00540494063999, -0.0484700223906,
	0.188602772878, -0.00700050151293, -0.0444874625774,
	0.198106302372, -0.0050322864349, -0.0641676281058,
	0.181533331452, -0.00470496686669, -0.0510928453189,
	0.203864792118, -0.00556293047365, -0.0501142971401,
	0.179994127745, -0.00469314712614, -0.0554447063479,
	0.184802529026, -0.00544231432321, -0.0496675687698,
	0.210698264605, -0.00449914128462, -0.0416312248672,
	0.212074184613, -0.00393467253671, -0.0485855298863,
	0.211810439498, -0.00428165778707, -0.044849259593,
	0.216598214332, -0.00528027187831, -0.0418559607942,
	0.212061917627, -0.00485775330476, -0.0408388597579,
	0.220831716694, -0.00344390620393, -0.0503358973952,
	0.219680223433, -0.00465504758605, -0.0332455463249,
	0.224272870618, -0.00496640497252, -0.0176570002819,
	0.230330324094, -0.00417429269451, -0.0253500822871,
	0.217384802842, -0.00494305770013, -0.0444538864035,
	0.243285432623, -0.00326152383124, -0.0473372256378,
	0.248523128629, -0.00387878796518, -0.0372631488874,
	0.239507653316, -0.0035572608361, -0.030890453858,
	0.281845394319, -0.00509384223074, -0.0412045987642,
	0.230089742334, -0.00495811593683, -0.0318654230316,
	0.248773770586, -0.00402827208378, -0.0250241284542,
	0.259648443718, -0.0029881503603, -0.0324583882928,
	0.274856032358, -0.0049715566539, -0.0528675516881,
	0.275484533823, -0.00545477290333, -0.0289421893547,
	0.266357580971, -0.0013554577301, -0.0243274418963,
	0.261927377716, -0.00329439867948, -0.0138761362048,
	0.273134002259, -0.00409302283367, -0.030136752233,
	0.280797535427, -0.00477153981556, -0.0141138723755,
	0.297498214087, -0.00381474703568, -0.0209435050704,
	0.295426846283, -0.00364194426386, -0.00851042016465,
	0.282281834578, -0.00229774626528, -0.0231662693653,
	0.287382953557, -0.00413726559099, -0.025167990419,
	0.290647336379, -0.00367820631018, -0.0242616652637,
	0.309305421371, -0.00350411789478, -0.0204402469899,
	0.290483710668, -0.00219822856369, -0.0264044344312,
	0.303762137745, -0.00218076297213, -0.0112773614761,
	0.297127270268, -0.00113965305704, -0.0232414884158,
	0.299322580337, -0.0024576894622, -0.00787981159807,
	0.317906630235, -0.00166894051045, -0.0250891583765,
	0.32129266484, -0.00160139574897, -0.0187367085111,
	0.332817012087, -0.00289453655402, -0.023236626316,
	0.280523985819, -0.003368476687, -0.0219112889651,
	0.315778163829, -0.00262015987799, -0.0238686312653,
	0.315068795241, -0.00465082585962, -0.0323352266286,
	0.302926282353, -0.0024935742051, -0.0065089793191,
	0.298948318988, -0.00300245619425, -0.0179735211463,
	0.307118330401, -0.00213592655227, -0.00979720053254,
	0.322611233139, -0.00211785537542, -0.019551207635,
	0.427256426985, -0.000640985694669, -0.00815454459567,
	0.426947059648, 9.02010226578e-05, -0.00452275095597,
	0.418964555293, 0.000369064379107, -0.0076976303703,
	0.41869362798, -0.000413665253127, -0.00620515352024,
	0.437837530379, -0.000293928548834, 0.00158957637553,
	0.407493685124, -0.000758184728905, -0.0162994205042,
	0.419263937514, -0.000526406944053, 0.00398769233602,
	0.428987713885, 0.000700339397906, -0.00739082510665,
	0.416421764757, -0.00069691509892, -0.00484617674981,
	0.39331630341, -0.00176462083133, -0.0150354646216,
	0.410819299588, -0.000770209314866, 0.0012831059647,
	0.408753275994, -0.000752403026022, -0.0104008691429,
	0.41207129701, -0.00154216664348, -0.00166406544898,
	0.403457046174, -0.0032605596821, -0.0226638749239,
	0.385336549693, -0.00237237346155, -0.00582007771576,
	0.375256326788, -0.00109685086651, -0.00964152985316,
	0.39925115657, -0.000605819612913, -0.015240582101,
	0.397045283103, -0.00178278360011, -0.00722363840645,
	0.390276952657, -0.000454396034205, 0.00494169194345,
	0.383749742461, -0.00305412575259, -0.0197282818424,
	0.38964214816, -0.00166397198017, -0.00595921843687,
	0.41059913922, -0.00381310478183, 0.00626117491128,
	0.360287678742, -0.00209560428335, -0.00956369847146,
	0.375688846241, -0.00218516695964, 0.00203174329118,
	0.381409041929, -0.000848057761408, -0.0209404549495,
	0.383148934127, -0.000846546945382, -0.00737705679023,
	0.377145342516, -0.00037240499981, -0.000163267198092,
	0.341408470665, -0.00191290092012, -0.00962103710852,
	0.34571291407, -0.00100145686599, -0.00839492941155,
	0.337160616324, -0.00199147236659, -0.0103713476285,
	0.3500133073, -0.00255090918947, 0.00148194449496,
	0.343915473194, -0.000297044144501, -0.0160938758235,
	0.333905153677, -0.00282338511268, -0.0190048561059,
	0.33425952176, -0.001925034471, -0.00579050927293,
	0.312041615355, 0.00021473434693, -0.0045315399513,
	0.33580898895, -0.00195115106957, -0.00710115540597,
	0.326291386716, -0.0011966553011, -0.0163762975405,
	0.290038199452, -0.00289311554506, -0.0197490690395,
	0.307246947911, -0.00222802191734, -0.0172402525167,
	0.278428623938, -0.00106431872689, -0.0256957020764,
	0.290789748332, -0.000859060803692, -0.0160496580363,
	0.293398994709, -0.00157111961568, -0.00754262793776,
	0.269861556918, -0.00163142173415, -0.0268154617671,
	0.263643111317, -0.0032054387356, -0.00649383172086,
	0.257105469395, -0.00221548681643, -0.0122093303778,
	0.257303725337, -0.00533148878819, -0.0326451643361,
	0.238311933569, -0.0031511116308, -0.0224734553881,
	0.24809873208, -0.000244881148603, -0.0307270542857,
	0.240571252415, -0.00382017337153, -0.0135488564864,
	0.219727802462, -0.00227658910149, -0.0205695944133,
	0.237476913202, -0.00305759293296, -0.022927908859,
	0.247031285584, -0.000372748977289, -0.0209860979838,
	0.205680933847, -0.00129143851514, -0.0307418858494,
	0.206615344984, -0.0016816389314, -0.0230430987504,
	0.181856867021, -0.00222530034847, -0.025363937876,
	0.203520509531, -0.00222207130817, -0.0182104996003,
	0.209639454762, -0.00336758849848, -0.0300673587205,
	0.193054356217, -0.00338626716948, -0.0317334438705,
	0.192892803372, -0.00332486176781, -0.03900108953,
	0.167573666257, -0.00461431483636, -0.0356972633111,
	0.171163683725, -0.00196102094384, -0.0361930157216,
	0.182445769169, -0.00402519580757, -0.040979658148,
	0.145038239612, -0.0028801467521, -0.0303088154469,
	0.168417300239, -0.00426662474838, -0.0407057867886,
	0.134834770433, -0.0050210145051, -0.0319369154827,
	0.138041900673, -0.00339154799166, -0.0483134056554,
	0.14982367929, -0.00288251078478, -0.0593480296605,
	0.150670932231, -0.00179042156456, -0.0688698879964,
	0.114431895862, -0.00423163729754, -0.0640351610823,
	0.138013416645, -0.00370451933381, -0.0722559938131,
	0.125468117847, -0.00481354863429, -0.0701845487844,
	0.140135142693, -0.00613412672386, -0.0748689433667,
	0.130379651058, -0.00499533191973, -0.0592433982842,
	0.123664782034, -0.00531512719636, -0.0751054810391,
	0.122929518593, -0.00481479896652, -0.0632471678908,
	0.126514909228, -0.00626106401209, -0.0723695267488,
	0.118743313207, -0.00531091623248, -0.0642961216903,
	0.117595601709, -0.00382539751581, -0.0456686766694,
	0.127717852829, -0.00403394479549, -0.0668958555596,
	0.1305592518, -0.00370904608129, -0.0641077807632,
	0.149582177112, -0.00516649158892, -0.0670775809975,
	0.156948171887, -0.00413771986147, -0.0561084045023,
	0.137464525985, -0.0049929226929, -0.0753166167751,
	0.153000890649, -0.00415572172938, -0.0509017510327,
	0.154835792404, -0.00517579351752, -0.0516978477466,
	0.170774267473, -0.00305289386363, -0.0456845421541,
	0.130568635526, -0.00411402923601, -0.0550104467618,
	0.178815406552, -0.0033429866093, -0.0362369733822,
	0.173779374988, -0.00448970723973, -0.0474553255218,
	0.165475248506, -0.00444517058238, -0.0465619256758,
	0.169453776267, -0.00340328904026, -0.0364969239623,
	0.181050659446, -0.00351606908155, -0.0301291874642,
	0.20123441424, -0.0028755232724, -0.0407056144897,
	0.17583478132, -0.00479726249613, -0.0217670115198,
	0.217805209025, -0.00250173297723, -0.0249125791388,
	0.193931314784, -0.00212517208132, -0.0288200171451,
	0.193635598831, -0.00305793560857, -0.020148737415,
	0.196458843258, -0.00168900070569, -0.0215415202405,
	0.256256015408, -0.00284299880433, -0.0188015957324,
	0.220934759434, -0.00301804146504, -0.0286385992329,
	0.247348046852, -0.00102992447533, -0.014940983779,
	0.254090668251, -0.00278066970387, -0.0188167259176,
	0.271952315547, -0.00209837440412, -0.0254482108127,
	0.249374327249, -0.00233333385568, -0.0196356370181,
	0.253632735264, -0.00194086613744, -0.0102053943901,
	0.268552618248, -0.00226986931382, -0.0328674984867,
	0.268811647138, -0.00341294417962, -0.0266661349442,
	0.292447449545, -0.000459427016123, -0.00540523620636,
	0.28852646795, -0.00226408290759, -0.0303698333639,
	0.302965965261, -0.00113784921256, -0.014196818429,
	0.281169923163, -0.00132830585841, -0.0079012676501,
	0.296441788555, -0.00252944202185, -0.00151260563469,
	0.301523411729, -0.00302889601453, -0.016900556181,
	0.344662576024, -0.00174037934252, -0.00530336111578,
	0.310697565529, -6.40047259683e-05, -0.0118904414132,
	0.33603632616, -0.00265264452127, -0.00119041326428,
	0.338574126786, -0.00284290168071, -0.00640868624586,
	0.331309899395, -0.00154860638234, -0.00518723765699,
	0.341094508093, -0.00266526378316, -0.00098296742485,
	0.359939288858, 0.000122327410588, -0.0256888126853,
	0.384159656428, -7.54279873122e-05, -0.0108875144725,
	0.352027471851, -0.00226864093826, -0.00385570321947,
	0.350543964122, -0.00201803560893, 7.09598294023e-05,
	0.370687384402, -0.000644087303209, -0.0065240706424,
	0.363691051076, -0.0020326794141, -0.000763509510518,
	0.363866053904, -0.000314990643383, -0.0055530614477,
	0.381145712556, -0.00148420000337, -0.0139353308438,
	0.429075987401, -0.00158253207606, -0.00957514636885,
	0.410326100371, -0.000849554331395, -0.0056578554869,
	0.423306007501, -0.000889280628374, -0.00703011238006,
	0.379513193427, -0.00249754067513, -0.0199141204286,
	0.386568307244, -0.00247873151595, 0.00752377699867,
	0.391600137895, 0.000363406290606, 0.000616636571146,
	0.402981746246, -0.0016784579503, -0.0115416214984,
	0.385259428312, -0.000712969764803, -0.00723243209899,
	0.40050872204, -0.00205456891287, -0.0156515461276,
	0.395753427335, -0.00244271522561, -0.00447630013453,
	0.403362897496, -0.00100420840134, -0.00581948998961,
	0.413656849864, -0.00392576407067, -0.00571406318715,
	0.434860315088, -0.000313336957848, 0.00352849789101,
	0.408879273475, -0.00117569145315, -0.00132587070097,
	0.414762456661, -0.00218300686529, -0.00219074001188,
	0.413086899594, -0.00181423523338, -0.0125307197784,
	0.451834110149, -0.00265812743129, -0.0021132911253,
	0.398615717497, -2.93718451592e-05, -0.00305097832218,
	0.395310874614, 0.000615915965049, -0.0128320274834,
	0.42306228963, -0.000223642116581, -0.0215167788653,
	0.453502607145, 0.00142294815851, 0.00335887672111,
	0.395244217072, -0.00169764285192, -0.00803214437179,
	0.41301496248, -0.0024535218201, -0.00263658696004,
	0.449711938362, -0.00203427223591, 0.000327096288168,
	0.435190618464, -0.000114715968161, -0.00222356520118,
	0.433678939807, -0.00044300187391, -0.00459752902659,
	0.425288830852, -0.00163129355705, -0.018614338258,
	0.427728680279, -0.00126365665803, -0.00248938896761,
	0.420476864481, -0.000340655095488, -0.0176853869,
	0.42035219746, -0.00105202434864, -0.00548230495336,
	0.403023275047, -0.000555043776848, 0.000224081335014,
	0.4072177167, 0.000578380330088, 0.00191267080089,
	0.411159210188, -0.00224913024962, -0.00605753697705,
	0.396263378612, -0.00100925460761, 0.0092201681994,
	0.416175600729, -0.000509019204789, -0.00120751522826,
	0.371236293584, -0.0015421909968, -0.0256419238969,
	0.41376959781, -0.00268175292088, -0.0143637082367,
	0.411616068084, -0.00150819819949, -0.00862042090117,
	0.385749678562, -0.00303018021325, -0.00119548548222,
	0.412477932597, 0.000231172607739, -0.0224192541154,
	0.374054388188, -0.00288200201194, -0.0128579807669,
	0.381926073091, -9.68382019612e-05, -0.00683686796554,
	0.363974068679, -0.00121507700416, 0.00493978286098,
	0.373057544864, -0.00270010107934, -0.0143963829362,
	0.356985018902, -0.00142966325323, -0.00163455834723,
	0.379692363701, -0.00337765033964, -0.0115645936988,
	0.368484157759, 0.000326383844551, -0.00867987794077,
	0.367349315252, -0.00019152572039, -0.0158347604132,
	0.361576331668, -0.000103085719931, 0.00401698183396,
	0.370827860701, -0.0010436241406, -0.00181418736529,
	0.368274060501, -0.00238006725809, 0.00506077427967,
	0.356456841685, -0.000430135840084, 0.00483380481629,
	0.35782696837, -0.000793783973036, -0.00954790187378,
	0.344481106794, -1.61761488192e-05, 0.00363818687119,
	0.331793631573, -0.00118185332188, -0.012024218796,
	0.339384443085, -0.00180272472617, -0.00640671235635,
	0.335149786653, -0.00032647614637, -0.0105799722155,
	0.344587516784, -0.00373061122377, -0.00964048781787,
	0.320679192712, -0.00257799061778, -0.0148014438237,
	0.322472948062, -0.00115343727842, -0.00794171558549,
	0.311158012317, -0.00266807971006, -0.00814654102984,
	0.298475765387, -0.00251307813371, 0.00610296449554,
	0.326940692008, -0.00235775963564, -0.0109864963155,
	0.276326934736, -0.000562258298634, -0.0177364550281,
	0.287040003215, -0.00256340462652, -0.0234824915817,
	0.279958176078, -0.00202224488765, -0.0123776042052,
	0.264645369013, -0.00207550730872, -0.00649871461736,
	0.251167907022, -0.00151811749088, -0.0218944647528,
	0.274625081921, -0.00177684347976, -0.0109534903588,
	0.249968047432, -0.00191991135417, -0.0140476345646,
	0.217814941403, -0.00385125146276, -0.0221690568851,
	0.233097091272, -0.00256892786786, -0.018711409846,
	0.224152144351, -0.00272947089786, -0.0180484442192,
	0.218186394565, -0.00280492956032, -0.0325152606201,
	0.24167660156, -0.00345479039242, -0.00954684196051,
	0.21206918092, -0.00397998877016, -0.0377705112867,
	0.224229567917, -0.00154481100096, -0.0338879119433,
	0.207858301036, -0.002046853509, -0.0333395638306,
	0.189282820573, -0.00458747997494, -0.0254045734645,
	0.205755193664, -0.00212717322673, -0.0197967622991,
	0.190438206765, -0.00508857023078, -0.0291806088065,
	0.197666362933, -0.0036103363388, -0.0288755587033,
	0.186311746554, -0.00273127885569, -0.0289926380795,
	0.168906247654, -0.0032555818078, -0.0275308036118,
	0.154382705805, -0.00189980404455, -0.0412795057298,
	0.167963000745, -0.00428950814844, -0.0451533931883,
	0.152416209412, -0.00379191200165, -0.0400541127324,
	0.158621293755, -0.00311010516106, -0.0542595398692,
	0.132355662907, -0.00356066489726, -0.0470774122975,
	0.159598260923, -0.0025436415749, -0.060756495629,
	0.150499892486, -0.00257665497397, -0.0475091634833,
	0.156561585791, -0.00301018364357, -0.0586568908397,
	0.144149224467, -0.00397316330185, -0.0652863145843,
	0.135007539073, -0.00421076414781, -0.0718601555788,
	0.151662194474, -0.00408919234978, -0.0597435000842,
	0.124125224143, -0.00380701824609, -0.0677017700658,
	0.165374290663, -0.00408980448573, -0.0797878501962,
	0.137359586756, -0.0057282668165, -0.061652902661,
	0.128972053739, -0.00291257631225, -0.0599008213782,
	0.127259599493, -0.00346306753903, -0.0763422481294,
	0.138200566193, -0.00242912043495, -0.0502024080425,
	0.127001062289, -0.00478444606531, -0.0624135800122,
	0.151467421106, -0.00207345964206, -0.0577514842112,
	0.138847285017, -0.00475030516199, -0.0542919617804,
	0.138796480895, -0.00450351142856, -0.0534843861411,
	0.156527276645, -0.00320462390707, -0.0567488267529,
	0.155578071149, -0.00329718343845, -0.0526495390738,
	0.147896760965, -0.00411002669691, -0.0561804184142,
	0.142249170884, -0.0025029757411, -0.0363788998665,
	0.157126069728, -0.00349724656887, -0.0387623353131,
	0.184308563335, -0.00286469004282, -0.0467509619759,
	0.164432254787, -0.00350417367585, -0.0471421833505,
	0.202435191923, -0.00260638364345, -0.0469060181659,
	0.191886333492, -0.00315212778911, -0.0394034987273,
	0.186922546544, -0.00384578276918, -0.0357359922288,
	0.186721408289, -0.00324583808542, -0.028206272541,
	0.204033053146, -0.00300545447966, -0.0228695195058,
	0.207893180221, -0.0022554571046, -0.0273844636436,
	0.222904027904, -0.00291618712163, -0.0184779268154,
	0.216182892817, -0.00434157660627, -0.0360055611364,
	0.204689246935, -0.00273797762644, -0.028473878746,
	0.223439981476, -0.00238826473513, -0.0227440367801,
	0.230748228541, -0.00174535678808, -0.0232598140786,
	0.278638635373, -0.00200098650722, -0.0191427670156,
	0.2435581769, -0.00244227165748, -0.0122436161215,
	0.233338046634, -0.00244963207348, -0.0122820425738,
	0.256371960645, -0.00163952567591, -0.00793294533649,
	0.284223388393, -0.00131647312168, -0.0216729373954,
	0.267040048212, -0.00114441196537, -0.00685741632869,
	0.282679746691, -0.00156076102802, 0.00419774614579,
	0.287701746445, -0.00271783896561, -0.0134787841307,
	0.291482439648, -0.00102095512011, -0.0138104266372,
	0.306607634428, -0.0017320067127, -0.0124889602959,
	0.302963391624, -0.00162601590978, -0.0412997500611,
	0.312161419798, -0.000894619495605, -0.0144832294132,
	0.338133574407, -0.00122482222558, 0.000693196573519,
	0.318908043177, -0.00202908709725, -0.0163211960639,
	0.335478820075, -0.00201416456479, -0.0254598358124,
	0.355520465163, -0.000764201800334, -0.00159162419393,
	0.326256100188, -0.00220719510661, -0.0158874436736,
	0.340188350596, -0.0032675584635, -0.015891951018,
	0.358848908864, -0.00238077998645, -0.00997772370856,
	0.319080525373, -0.001156440924, -0.0148171634378,
	0.344775304011, -0.00117676487694, -0.00220833485838,
	0.369570020436, -0.00149347815028, -0.021680958567,
	0.329921638993, -0.00182020048372, 0.00269139703769,
	0.367518109137, -0.00146759617469, -0.00580384456732,
	0.352024582205, -8.59650576344e-05, -0.0227355424781,
	0.376237389951, -0.00185887299902, -0.00970516229677,
	0.351744446612, 5.86643519303e-05, 0.0101466713079,
	0.408678631047, -4.9554769719e-05, -0.000694251616898,
	0.370463571212, -0.00318322212523, -0.00963518763077,
	0.3931245759, -0.000396725131614, -0.0171284809429,
	0.405088568029, -0.00135205394995, -0.0121159897606,
	0.404516846418, -0.00114429268461, -0.00557714119217,
	0.421414877186, -0.000800495728765, 0.013304983573,
	0.404046601339, -0.00131859310429, -0.0125458241959,
	0.408574069169, -0.00198677542287, -0.0107852649112,
	0.410109953867, 0.000506451973743, -0.0145637773043,
	0.394264450676, -0.00161126280335, -0.0116413066445,
	0.404821583849, -0.000888739829293, -0.0107458503315,
	0.40289080524, -0.00179072336834, -0.00742941087562,
	0.400132089976, -0.00276906146981, -0.0100073773141,
	0.397623716391, -0.00204455955696, -0.00611780103683,
	0.397766015587, -0.00136067843641, -0.0153385346317,
	0.403917426839, -0.000224869403738, -0.0116558871052,
	0.412636859936, -0.00281473158402, -0.0132378979063,
	0.398789967269, -0.00190673546355, -0.0146865557158,
	0.403217631287, -0.0034030663261, 0.00163087118972,
	0.447768746094, 0.000890600106361, -0.0102530527996,
	0.420251518926, -0.00177938420383, -0.00849607450988,
	0.408845650045, -0.00324870346696, -0.00498788645551;

  MatrixXd OdomNoise(3,3);

  OdomNoise << 0.000193148171863,     0,     0,
	0,9.99975000625e-07,     0,
	0,     0,6.09234839573e-05; 

  // Loops results (MATLAB) 
  MatrixXd LoopD(4,3);

  LoopD << 	-2.19221576848,-0.145949401585,0.134004324445,
  -2.73047962763,1.25660762569,-0.202017151741,
  1.10737265236,0.803105768698,0.215238520201,
  -2.4435195782,1.38716427067,-0.232634243616;

  uint LoopP1[] = {192, 329, 363, 478};
  uint LoopP2[] = {0, 83, 115, 181};

  MatrixXd LoopNoise(3,3);

  LoopNoise <<  0.04,     0,     0,
		0,  0.04,     0,
		0,     0,7.61543549467e-05;

  // sensors simulation variables
  uint loopStep = 0;
  
  // INITIALIZATION AND SIMULATION VALUES
  uint dim = 3;
  
  // Initial pose gaussian
  MatrixXd initS(dim, dim);
  initS << 0.0100, 0, 0,
  0, 0.01, 0,
  0, 0, 0.0076;
  Vector3d initv;
  initv << 0, 6, 0;
  
  //CGaussian initPoseGaussian(initv, initS);

  // Parameters	
  Params Parameters;
  Parameters.matchArea << 3, 3, 15 * M_PI / 180;
  Parameters.pdRange.first = 0.1; // If the probability of 2 poses of being closer than 'matchArea' is larger than 'pd.first' we try to create a loop.
  Parameters.pdRange.second = 0.9; // If the probability of 2 poses of being closer than 'matchArea' is larger than 'pd.second' they are close enough for one of them to be redundant
  Parameters.igRange.first = 1; // If the information gain is smaller than 'ig.first' the pose is redundant and it can be overwrite next time slice	
  Parameters.igRange.second = 3; // If the information gain is larger than 'ig.second' we try to create a loop
  Parameters.LoopNoise = LoopNoise;
	Parameters.K_mahalanobis = 4;
	Parameters.ignorePrevious = 1;
	Parameters. min_cov = 1e-10;

  // creating poseSLAM object
  CPoseSLAM pSLAM(initv, initS, Parameters);
  
  // START SIMULATION
  printf("\n---------------------------------------------------------------");
  printf("\n---------------------- START SIMULATION -----------------------");
  printf("\n---------------------------------------------------------------\n\n");
  
  for(uint step = 1; step < nSteps; step++)
  {
    // Odometry reception
    Vector3d d(3);
    d = odometry.row(step - 1);
    
    // State Augmentation
    pSLAM.augmentation(step, d, OdomNoise);
    
    // Create list of link candidates
    pSLAM.create_candidates_list();
    
    // Process all link candidates for loop closure
    while (pSLAM.any_candidate())
    {
      // Select the most information gain link candidate
      pSLAM.select_best_candidate();
      
      // Check if the present pose is redundant
      pSLAM.redundant_evaluation();
      
      // Check if we can try loop closure
      if (pSLAM.loop_closure_requeriments())
      {

        while (step > LoopP1[loopStep] && loopStep < 3)
			    loopStep++;

			  // Sensor call for loop closure
			  if (step == LoopP1[loopStep] && pSLAM.get_candidate_step() == LoopP2[loopStep])
		    {
          //The sensor(s) confirms the loop closure we try to close it
        	if (pSLAM.try_loop_closure(LoopNoise, LoopD.row(loopStep))) 
	        {
	          printf("Loop Closed!\n");
	          pSLAM.update_candidates_list();
	        }
	        else
	        	printf("Couldn't close the loop!\n");
        }
      }
    }
  }
  
  // PRINT RESULTS
  // Print Loops Closed in screen
  std::vector<Loop> LC = pSLAM.get_FF().get_PF().get_loops();
  printf("LOOPS CLOSED: %lu\n", LC.size());
  for (uint i = 0; i < LC.size(); i++)
    printf("\t%i: steps %i - %i || states %i - %i\n", 
    				i + 1,
    				LC[i].p1,
    				LC[i].p2,
    				pSLAM.get_FF().get_PF().step_2_state(LC[i].p1),
    				pSLAM.get_FF().get_PF().step_2_state(LC[i].p2));
}
